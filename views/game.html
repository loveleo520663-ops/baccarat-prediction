<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <meta name="cache-buster" content="20241107-1445">
    <meta name="format-detection" content="telephone=no">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <!-- ç‰ˆæœ¬æ¨™è¨˜ï¼šv2.4 - æ‰‹æ©Ÿç‰ˆæ ¼å­å„ªåŒ– 2024-11-07 -->
    <title>ç™¾å®¶æ¨‚é æ¸¬ç³»çµ± v2.4 - éŠæˆ²å¤§å»³</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }

        html {
            font-size: 16px;
            -webkit-text-size-adjust: 100%;
        }

        body {
            font-family: 'Microsoft JhengHei', -apple-system, BlinkMacSystemFont, 'Segoe UI', Arial, sans-serif;
            background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 25%, #404040 50%, #2d2d2d 75%, #1a1a1a 100%);
            color: #E5E5E5;
            min-height: 100vh;
            min-height: -webkit-fill-available;
            overflow-x: hidden;
            position: relative;
            line-height: 1.4;
        }

        /* é ‚éƒ¨å°èˆªæ¬„ */
        .navbar {
            background: rgba(26, 26, 26, 0.95);
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            backdrop-filter: blur(10px);
            border-bottom: 3px solid #d4af37;
            box-shadow: 0 2px 10px rgba(212, 175, 55, 0.3);
        }

        .nav-brand {
            display: flex;
            align-items: center;
            gap: 15px;
            font-size: 1.5rem;
            font-weight: bold;
        }

        .nav-brand i {
            color: #d4af37;
            font-size: 2rem;
            text-shadow: 0 0 10px rgba(212, 175, 55, 0.5);
        }

        .nav-user {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 10px;
            color: #d4af37;
        }

        .logout-btn {
            background: linear-gradient(135deg, #2d2d2d 0%, #404040 100%);
            color: #d4af37;
            border: 2px solid #d4af37;
            padding: 8px 15px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: bold;
            transition: all 0.3s;
        }

        .logout-btn:hover {
            background: linear-gradient(135deg, #404040 0%, #555555 100%);
            box-shadow: 0 0 15px rgba(212, 175, 55, 0.6);
            transform: translateY(-2px);
        }

        .admin-btn {
            background: linear-gradient(135deg, #2d2d2d 0%, #404040 100%);
            color: #d4af37;
            border: 2px solid #d4af37;
            padding: 8px 15px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: bold;
            transition: all 0.3s;
            margin-right: 10px;
        }

        .admin-btn:hover {
            background: linear-gradient(135deg, #404040 0%, #555555 100%);
            box-shadow: 0 0 15px rgba(212, 175, 55, 0.6);
            transform: translateY(-2px);
        }

        .admin-btn.hidden {
            display: none;
        }

        /* ä¸»è¦éŠæˆ²å€åŸŸ */
        .game-container {
            display: grid;
            grid-template-columns: 1fr 350px;
            gap: 20px;
            padding: 20px;
            max-width: 1400px;
            margin: 0 auto;
            min-height: calc(100vh - 80px);
        }

        /* å·¦å´å€åŸŸ - ç‰Œè‰²é¸æ“‡å™¨ */
        .card-selector {
            background: linear-gradient(135deg, #2d2d2d 0%, #404040 100%);
            border: 3px solid #d4af37;
            border-radius: 15px;
            padding: 20px;
            backdrop-filter: blur(10px);
            box-shadow: 0 0 20px rgba(212, 175, 55, 0.3);
        }

        .selector-title {
            text-align: center;
            font-size: 1.2rem;
            margin-bottom: 30px;
            color: #d4af37;
            font-weight: normal;
            text-shadow: 0 0 10px rgba(212, 175, 55, 0.5);
        }

        .cards-layout {
            display: flex;
            justify-content: space-around;
            align-items: flex-start;
            padding: 20px;
        }

        .player-side {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
        }

        .player-label {
            font-size: 1.2rem;
            color: #d4af37;
            font-weight: normal;
            text-align: center;
            text-shadow: 0 0 8px rgba(212, 175, 55, 0.5);
        }

        .triangle-layout {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
        }

        .top-row {
            display: flex;
            gap: 10px;
        }

        .bottom-row {
            display: flex;
            justify-content: center;
        }

        .card-slot {
            width: 60px;
            height: 85px;
            border: 2px solid #666666;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            background: #404040;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
            position: relative;
        }

        .card-slot.red {
            background: #DC143C;
            border-color: #FF6B6B;
            box-shadow: 0 0 15px rgba(220, 20, 60, 0.6), inset 0 0 10px rgba(255, 255, 255, 0.1);
            transform: scale(1.05);
        }

        .card-slot.black {
            background: #1a1a1a;
            border-color: #FFFFFF;
            box-shadow: 0 0 15px rgba(255, 255, 255, 0.4), inset 0 0 10px rgba(255, 255, 255, 0.2);
            transform: scale(1.05);
        }

        .card-slot:hover {
            transform: scale(1.1);
            box-shadow: 0 0 20px rgba(212, 175, 55, 0.6);
            border-color: #d4af37;
        }

        .card-slot.red:hover {
            box-shadow: 0 0 25px rgba(220, 20, 60, 0.8), inset 0 0 15px rgba(255, 255, 255, 0.2);
            border-color: #FF8E8E;
        }

        .card-slot.black:hover {
            box-shadow: 0 0 25px rgba(255, 255, 255, 0.6), inset 0 0 15px rgba(255, 255, 255, 0.3);
            border-color: #FFFFFF;
        }

        /* ç¬¬ä¸‰å¼µç‰Œæ—‹è½‰æ•ˆæœ */
        .card-slot[data-index="2"] {
            transform: rotate(90deg);
            transform-origin: center;
        }

        .card-slot[data-index="2"]:hover {
            transform: rotate(90deg) scale(1.1);
        }

        .card-slot[data-index="2"].red {
            transform: rotate(90deg) scale(1.05);
        }

        .card-slot[data-index="2"].red:hover {
            transform: rotate(90deg) scale(1.15);
        }

        .card-slot[data-index="2"].black {
            transform: rotate(90deg) scale(1.05);
        }

        .card-slot[data-index="2"].black:hover {
            transform: rotate(90deg) scale(1.15);
        }

        /* éŠæˆ²è¨˜éŒ„å€åŸŸ */
        .game-record {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-bottom: 30px;
        }

        .record-header {
            background: linear-gradient(135deg, #2d2d2d 0%, #404040 100%);
            border: 3px solid #d4af37;
            border-radius: 15px;
            padding: 15px;
            text-align: center;
            box-shadow: 0 0 20px rgba(212, 175, 55, 0.3);
        }

        .record-title {
            font-size: 1.3rem;
            color: #d4af37;
            font-weight: bold;
            margin-bottom: 10px;
            text-shadow: 0 0 10px rgba(212, 175, 55, 0.5);
        }

        .record-controls {
            display: flex;
            gap: 10px;
            justify-content: center;
        }

        .control-btn {
            padding: 10px 15px;
            border: 2px solid #d4af37;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
            text-transform: uppercase;
        }

        .clear-btn {
            background: linear-gradient(135deg, #8B0000 0%, #DC143C 100%);
            color: white;
            border-color: #DC143C;
        }

        .undo-btn {
            background: linear-gradient(135deg, #2d2d2d 0%, #404040 100%);
            color: #d4af37;
            border-color: #d4af37;
        }

        .control-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(212, 175, 55, 0.4);
        }

        /* éŠæˆ²è¨˜éŒ„å®¹å™¨ */
        .record-container {
            background: linear-gradient(135deg, #2d2d2d 0%, #404040 100%);
            border: 3px solid #d4af37;
            border-radius: 15px;
            padding: 15px;
            min-height: 220px;
            height: auto;
            box-shadow: 0 0 20px rgba(212, 175, 55, 0.3);
            position: relative;
            overflow: visible;
        }

        .record-grid {
            display: grid;
            grid-template-rows: repeat(5, 1fr);
            grid-template-columns: repeat(20, 1fr);
            grid-auto-flow: column;
            gap: 2px;
            min-height: 200px;
            height: auto;
            width: 100%;
            overflow-x: auto;
            overflow-y: visible;
            background: #1a1a1a;
            padding: 8px;
            border-radius: 8px;
            border: 2px solid #d4af37;
            box-sizing: border-box;
        }

        .record-item {
            background: #404040;
            border: 1px solid #666666;
            border-radius: 2px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 1.1rem;
            transition: all 0.3s;
            box-shadow: inset 0 0 2px rgba(0, 0, 0, 0.3);
            min-height: 32px;
            height: 32px;
            aspect-ratio: 1;
            box-sizing: border-box;
        }

        .record-item.banker {
            background: linear-gradient(135deg, #8B0000 0%, #DC143C 100%);
            color: white;
            border-color: #DC143C;
        }

        .record-item.player {
            background: linear-gradient(135deg, #0047AB 0%, #1E90FF 100%);
            color: white;
            border-color: #1E90FF;
        }

        .record-item.tie {
            background: linear-gradient(135deg, #006400 0%, #228B22 100%);
            color: white;
            border-color: #228B22;
        }

        .record-item.empty {
            background: transparent;
            border: 1px dashed #555;
            color: transparent;
        }

        .record-item:hover {
            transform: scale(1.05);
            box-shadow: 0 0 8px rgba(212, 175, 55, 0.4);
            z-index: 1;
        }

        .record-item.empty:hover {
            transform: none;
            box-shadow: none;
        }

        /* çµæœæŒ‰éˆ•å€åŸŸ */
        .result-buttons {
            display: flex;
            gap: 15px;
            margin-top: 20px;
        }

        .result-btn {
            flex: 1;
            padding: 20px;
            border: 3px solid #555555;
            border-radius: 15px;
            font-size: 1.2rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            text-transform: uppercase;
            position: relative;
            overflow: hidden;
        }

        .result-btn.banker {
            background: linear-gradient(135deg, #8B0000 0%, #DC143C 100%);
            color: white;
            border-color: #DC143C;
        }

        .result-btn.player {
            background: linear-gradient(135deg, #0047AB 0%, #1E90FF 100%);
            color: white;
            border-color: #1E90FF;
        }

        .result-btn.tie {
            background: linear-gradient(135deg, #006400 0%, #228B22 100%);
            color: white;
            border-color: #228B22;
        }

        .result-btn:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(212, 175, 55, 0.4);
        }

        .result-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* å³å´å€åŸŸ - åˆ†æå’Œèµ°å‹¢ */
        .analysis-panel {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .prediction-section, .statistics-section, .trend-section {
            background: linear-gradient(135deg, #2d2d2d 0%, #404040 100%);
            border: 3px solid #d4af37;
            border-radius: 15px;
            padding: 20px;
            backdrop-filter: blur(10px);
            box-shadow: 0 0 20px rgba(212, 175, 55, 0.3);
        }

        .section-title {
            font-size: 1.2rem;
            color: #d4af37;
            margin-bottom: 15px;
            font-weight: bold;
            text-align: center;
            text-shadow: 0 0 10px rgba(212, 175, 55, 0.5);
        }

        .prediction-result {
            text-align: center;
            padding: 20px;
            border-radius: 15px;
            background: linear-gradient(135def, rgba(26, 26, 26, 0.8) 0%, rgba(64, 64, 64, 0.3) 100%);
            border: 2px solid rgba(212, 175, 55, 0.3);
            margin-bottom: 15px;
        }

        .prediction-text {
            font-size: 1.1rem;
            margin-bottom: 10px;
            color: #E5E5E5;
        }

        .confidence {
            font-size: 0.9rem;
            opacity: 0.8;
            color: #d4af37;
        }

        .stat-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            padding: 12px;
            background: linear-gradient(135deg, rgba(26, 26, 26, 0.8) 0%, rgba(64, 64, 64, 0.3) 100%);
            border: 2px solid rgba(212, 175, 55, 0.3);
            border-radius: 8px;
            font-weight: bold;
            color: #E5E5E5;
        }

        .trend-chart {
            height: 200px;
            background: linear-gradient(135deg, rgba(26, 26, 26, 0.8) 0%, rgba(64, 64, 64, 0.3) 100%);
            border: 2px solid rgba(212, 175, 55, 0.3);
            border-radius: 8px;
            padding: 10px;
            position: relative;
        }

        #trendCanvas {
            width: 100%;
            height: 100%;
        }



        /* éŸ¿æ‡‰å¼è¨­è¨ˆ */
        /* å¹³æ¿ç‰ˆ (1024pxä»¥ä¸‹) */
        @media (max-width: 1024px) {
            .game-container {
                grid-template-columns: 1fr;
                gap: 15px;
                padding: 15px;
            }
            
            .record-container {
                min-height: 160px;
            }
            
            .record-grid {
                height: 140px;
            }
            
            .record-item {
                font-size: 1.0rem;
            }
            
            .card-area {
                gap: 15px;
            }
            
            .result-buttons {
                gap: 12px;
            }
        }

        /* æ‰‹æ©Ÿç‰ˆ (768pxä»¥ä¸‹) */
        @media (max-width: 768px) {
            /* æ‰‹æ©Ÿç‰ˆæ¨™è­˜ - ç”¨æ–¼æ¸¬è©¦ */
            .navbar::before {
                content: "ğŸ“± æ‰‹æ©Ÿç‰ˆ 5Ã—10";
                position: absolute;
                top: -20px;
                left: 10px;
                font-size: 12px;
                color: #d4af37;
                background: rgba(26, 26, 26, 0.9);
                padding: 2px 8px;
                border-radius: 10px;
                z-index: 1000;
            }
            
            body {
                font-size: 14px;
            }
            
            .game-container {
                padding: 8px;
                gap: 10px;
                max-width: 100vw;
                overflow-x: hidden;
            }
            
            .navbar {
                padding: 8px 15px;
                font-size: 0.9rem;
            }
            
            .nav-brand {
                font-size: 1.1rem;
            }
            
            .nav-buttons .btn {
                padding: 6px 12px;
                font-size: 0.8rem;
            }
            
            .record-container {
                padding: 6px;
                min-height: 180px;
                height: auto;
                overflow: visible;
                margin: 5px 0;
            }
            
            .record-grid {
                min-height: 160px;
                height: auto;
                gap: 1px;
                padding: 3px;
                grid-template-columns: repeat(10, 1fr); /* æ‰‹æ©Ÿç‰ˆï¼š10åˆ— */
                grid-template-rows: repeat(5, 1fr);
                grid-auto-flow: column;
                display: grid;
                overflow-y: visible;
            }
            
            .record-item {
                font-size: 0.7rem;
                aspect-ratio: 1;
                min-height: 26px;
                height: 26px;
                border-radius: 3px;
            }
            
            .selector-title {
                font-size: 1rem;
                margin: 10px 0 8px 0;
            }
            
            .cards-layout {
                gap: 15px;
                margin: 8px 0;
            }
            
            .player-side {
                flex: 1;
                min-width: 0;
            }
            
            .player-label {
                font-size: 1.1rem;
                margin-bottom: 8px;
            }
            
            .card-slot {
                min-height: 45px;
                height: 45px;
                font-size: 0.7rem;
                border-radius: 6px;
            }
            
            .triangle-layout {
                gap: 6px;
            }
            
            .result-buttons {
                gap: 8px;
                margin: 10px 0;
                flex-direction: row;
                justify-content: space-around;
            }
            
            .result-btn {
                padding: 10px 8px;
                font-size: 0.8rem;
                flex: 1;
                min-height: 60px;
            }
            
            .control-buttons {
                gap: 6px;
                margin: 8px 0;
            }
            
            .control-btn {
                padding: 8px 10px;
                font-size: 0.7rem;
            }
            
            .analysis-panel {
                gap: 12px;
            }
            
            .section-title {
                font-size: 1rem;
                margin-bottom: 10px;
            }
            
            .trend-chart {
                height: 150px;
                padding: 8px;
            }
            
            .stat-item {
                padding: 8px 10px;
                font-size: 0.85rem;
            }
        }

        /* iPhone Pro Max å’Œå¤§å±æ‰‹æ©Ÿå„ªåŒ– (414px-430px) */
        @media (max-width: 430px) and (min-width: 375px) {
            body {
                font-size: 15px;
            }
            
            .game-container {
                padding: 10px;
                gap: 12px;
            }
            
            .record-container {
                min-height: 200px;
                padding: 8px;
            }
            
            .record-grid {
                min-height: 180px;
                gap: 2px;
                padding: 4px;
            }
            
            .record-item {
                font-size: 0.75rem;
                min-height: 30px;
                height: 30px;
            }
            
            .card-slot {
                min-height: 50px;
                height: 50px;
                font-size: 0.75rem;
            }
            
            .result-btn {
                padding: 12px 10px;
                font-size: 0.85rem;
                min-height: 65px;
            }
            
            .trend-chart {
                height: 160px;
            }
        }

        /* å°æ‰‹æ©Ÿç‰ˆ (375pxä»¥ä¸‹) */
        @media (max-width: 375px) {
            /* å°æ‰‹æ©Ÿç‰ˆæ¨™è­˜ - ç”¨æ–¼æ¸¬è©¦ */
            .navbar::before {
                content: "ğŸ“± å°å±ç‰ˆ 5Ã—8" !important;
            }
            
            body {
                font-size: 13px;
            }
            
            .game-container {
                padding: 6px;
                gap: 8px;
            }
            
            .record-container {
                padding: 5px;
                min-height: 170px;
                height: auto;
                overflow: visible;
            }
            
            .record-grid {
                min-height: 150px;
                height: auto;
                gap: 1px;
                padding: 2px;
                grid-template-columns: repeat(8, 1fr); /* å°å±æ‰‹æ©Ÿï¼š8åˆ— */
                grid-template-rows: repeat(5, 1fr);
                grid-auto-flow: column;
                display: grid;
                overflow-y: visible;
            }
            
            .record-item {
                font-size: 0.65rem;
                min-height: 24px;
                height: 24px;
            }
            
            .card-slot {
                min-height: 40px;
                height: 40px;
                font-size: 0.65rem;
            }
            
            .result-btn {
                padding: 8px 6px;
                font-size: 0.75rem;
                min-height: 55px;
            }
            
            .trend-chart {
                height: 140px;
            }
        }

        /* å‹•ç•«æ•ˆæœ */
        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(204, 204, 204, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(204, 204, 204, 0); }
            100% { box-shadow: 0 0 0 0 rgba(204, 204, 204, 0); }
        }

        .pulse {
            animation: pulse 2s infinite;
        }

        /* é¡å¤–çš„ç°è‰²æ¼¸è®Šæ•ˆæœ */
        .nav-brand span,
        .selector-title,
        .record-title,
        .section-title {
            background: linear-gradient(45deg, #CCCCCC, #FFFFFF, #CCCCCC);
            background-size: 200% 200%;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: gradientShift 3s ease-in-out infinite;
        }

        @keyframes gradientShift {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }
    </style>
</head>
<body>
    <!-- é ‚éƒ¨å°èˆªæ¬„ -->
    <nav class="navbar">
        <div class="nav-brand">
            <i class="fas fa-crown"></i>
            <span>ç™¾å®¶æ¨‚é æ¸¬ç³»çµ±</span>
            <small style="font-size: 0.6rem; color: #888; margin-left: 8px;">v2.3</small>
        </div>
        
        <div class="nav-user">
            <div class="user-info">
                <i class="fas fa-user"></i>
                <span id="username">ç®¡ç†å“¡</span>
            </div>
            <button id="adminBtn" class="admin-btn hidden">
                <i class="fas fa-cog"></i> å¾Œå°ç®¡ç†
            </button>
            <button id="logoutBtn" class="logout-btn">
                <i class="fas fa-sign-out-alt"></i>
            </button>
        </div>
    </nav>

    <!-- ä¸»è¦éŠæˆ²å€åŸŸ -->
    <div class="game-container">
        <!-- å·¦å´ï¼šç‰Œè‰²é¸æ“‡å™¨ -->
        <div class="card-selector">
            <!-- éŠæˆ²è¨˜éŒ„ -->
            <div class="game-record">
                <div class="record-header">
                    <div class="record-title">
                        <i class="fas fa-history"></i> éŠæˆ²è¨˜éŒ„
                    </div>
                    <div class="record-controls">
                        <button class="control-btn clear-btn" id="clearBtn">
                            <i class="fas fa-trash"></i> æ¸…ç©ºè¨˜éŒ„
                        </button>
                        <button class="control-btn undo-btn" id="undoBtn">
                            <i class="fas fa-undo"></i> æ’¤éŠ·ä¸Šä¸€å±€
                        </button>
                    </div>
                </div>

                <div class="record-container">
                    <div class="record-grid" id="recordGrid">
                        <!-- è¨˜éŒ„é …ç›®å°‡å‹•æ…‹ç”Ÿæˆ -->
                    </div>
                </div>

                <!-- çµæœæŒ‰éˆ• -->
                <div class="result-buttons">
                    <button class="result-btn banker" id="bankerBtn">
                        <i class="fas fa-crown"></i><br>èŠ
                    </button>
                    <button class="result-btn tie" id="tieBtn">
                        <i class="fas fa-handshake"></i><br>å’Œ
                    </button>
                    <button class="result-btn player" id="playerBtn">
                        <i class="fas fa-user"></i><br>é–’
                    </button>
                </div>
            </div>
            
            <div class="selector-title">
                é¸æ“‡ç‰Œé¢é¡è‰²
            </div>
            
            <div class="cards-layout">
                <!-- é–’å®¶å€åŸŸ - å·¦å´ -->
                <div class="player-side">
                    <div class="player-label">é–’</div>
                    <div class="triangle-layout">
                        <div class="top-row">
                            <div class="card-slot" data-index="0" data-type="player"></div>
                            <div class="card-slot" data-index="1" data-type="player"></div>
                        </div>
                        <div class="bottom-row">
                            <div class="card-slot" data-index="2" data-type="player"></div>
                        </div>
                    </div>
                </div>

                <!-- èŠå®¶å€åŸŸ - å³å´ -->
                <div class="player-side">
                    <div class="player-label">èŠ</div>
                    <div class="triangle-layout">
                        <div class="top-row">
                            <div class="card-slot" data-index="0" data-type="banker"></div>
                            <div class="card-slot" data-index="1" data-type="banker"></div>
                        </div>
                        <div class="bottom-row">
                            <div class="card-slot" data-index="2" data-type="banker"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- å³å´ï¼šåˆ†æå’Œèµ°å‹¢ -->
        <div class="analysis-panel">
            <!-- é æ¸¬å»ºè­° -->
            <div class="prediction-section">
                <div class="section-title">
                    <i class="fas fa-crystal-ball"></i> é æ¸¬å»ºè­°
                </div>
                <div class="prediction-result" id="predictionResult">
                    <div class="prediction-text">è¨˜éŒ„è‡³å°‘5å±€å¾Œé¡¯ç¤ºé æ¸¬</div>
                    <div class="confidence">æº–ç¢ºåº¦å°‡æ ¹æ“šæ­·å²æ•¸æ“šè¨ˆç®—</div>
                </div>
            </div>

            <!-- çµ±è¨ˆè³‡æ–™ -->
            <div class="statistics-section">
                <div class="section-title">
                    <i class="fas fa-chart-pie"></i> çµ±è¨ˆè³‡æ–™
                </div>
                <div class="stat-item">
                    <span>ç¸½å±€æ•¸ï¼š</span>
                    <span id="totalGames">0</span>
                </div>
                <div class="stat-item">
                    <span>èŠå‹ï¼š</span>
                    <span id="bankerWins">0 (0%)</span>
                </div>
                <div class="stat-item">
                    <span>é–’å‹ï¼š</span>
                    <span id="playerWins">0 (0%)</span>
                </div>
                <div class="stat-item">
                    <span>å’Œå±€ï¼š</span>
                    <span id="tieGames">0 (0%)</span>
                </div>
            </div>

            <!-- è¶¨å‹¢åˆ†æ -->
            <!-- è¶¨å‹¢åœ–è¡¨ -->
            <div class="trend-section">
                <div class="section-title">
                    <i class="fas fa-chart-line"></i> è¶¨å‹¢åœ–è¡¨
                </div>
                <div class="trend-chart" id="trendChart">
                    <canvas id="trendCanvas" width="300" height="150"></canvas>
                </div>
            </div>
        </div>
    </div>
                    <i class="fas fa-chart-line" style="font-size: 3rem; opacity: 0.5;"></i>
                </div>
            </div>
        </div>
    </div>

    <script>
        // å…§åµŒèªè­‰åŠŸèƒ½ï¼Œé¿å…å¤–éƒ¨è¼‰å…¥å•é¡Œ
        class Auth {
            constructor() {
                this.user = null;
                this.token = localStorage.getItem('token');
                // æ¸…ç†èˆŠçš„localStorageæ•¸æ“š
                this.cleanupOldStorage();
                this.loadUser();
            }

            cleanupOldStorage() {
                // æ¸…ç†èˆŠçš„éµå
                localStorage.removeItem('authToken');
                localStorage.removeItem('username');
            }

            loadUser() {
                const userStr = localStorage.getItem('user');
                if (userStr) {
                    try {
                        this.user = JSON.parse(userStr);
                    } catch (e) {
                        console.error('è§£æç”¨æˆ¶æ•¸æ“šå¤±æ•—:', e);
                        this.logout();
                    }
                }
            }

            isAuthenticated() {
                return !!(this.token && this.user);
            }

            getUser() {
                return this.user;
            }

            isAdmin() {
                return this.user && this.user.role === 'admin';
            }

            logout() {
                this.user = null;
                this.token = null;
                localStorage.removeItem('user');
                localStorage.removeItem('token');
                window.location.href = '/login';
            }
        }

        // å…¨åŸŸèªè­‰ç‰©ä»¶
        const auth = new Auth();
        
        // å…¨åŸŸç™»å‡ºå‡½æ•¸
        function logout() {
            auth.logout();
        }
    </script>
    <script>
        // ç‰Œè‰²é¸æ“‡å‡½æ•¸
        function testCardClick(element) {
            console.log('=== ç‰Œè‰²é¸æ“‡è¢«é»æ“Š ===');
            console.log('å…ƒç´ :', element);
            console.log('å…ƒç´ é¡å:', element.className);
            
            const type = element.getAttribute('data-type'); // player æˆ– banker
            const index = parseInt(element.getAttribute('data-index')); // 0, 1, 2
            
            console.log(`é¡å‹: ${type}, ç´¢å¼•: ${index}`);
            
            // ç²å–ç•¶å‰é¡è‰²ç‹€æ…‹
            let currentColor = null;
            if (element.classList.contains('red')) {
                currentColor = 'red';
            } else if (element.classList.contains('black')) {
                currentColor = 'black';
            }
            
            console.log(`ç•¶å‰é¡è‰²: ${currentColor}`);
            
            // åˆ‡æ›é¡è‰²
            let nextColor;
            if (currentColor === null) {
                nextColor = 'red';
            } else if (currentColor === 'red') {
                nextColor = 'black';
            } else if (currentColor === 'black') {
                nextColor = null; // å¯ä»¥å–æ¶ˆé¸æ“‡
            }
            
            console.log(`ä¸‹ä¸€å€‹é¡è‰²: ${nextColor}`);
            
            // æ›´æ–°è¦–è¦ºæ•ˆæœ
            if (nextColor) {
                element.className = `card-slot ${nextColor}`;
            } else {
                element.className = 'card-slot';
            }
            
            console.log(`æ›´æ–°å¾Œé¡å: ${element.className}`);
            
            // æ›´æ–°éŠæˆ²ç‹€æ…‹
            if (game && game.currentRound) {
                game.currentRound[type].cards[index] = nextColor;
                console.log(`${type} ç¬¬${index + 1}å¼µç‰Œè¨­ç‚º: ${nextColor}`);
                console.log('ç•¶å‰éŠæˆ²ç‹€æ…‹:', game.currentRound);
            } else {
                console.log('éŠæˆ²å°è±¡ä¸å­˜åœ¨æˆ–ç•¶å‰å›åˆä¸å­˜åœ¨');
            }
            
            console.log('=== ç‰Œè‰²é¸æ“‡è™•ç†å®Œæˆ ===');
        }

        // éŠæˆ²ç‹€æ…‹ç®¡ç†
        class BaccaratGame {
            constructor() {
                this.gameHistory = [];
                this.currentRound = {
                    player: { cards: [null, null, null] }, // æ¢å¾©ä¸‰å¼µç‰Œ
                    banker: { cards: [null, null, null] }  // æ¢å¾©ä¸‰å¼µç‰Œ
                };
                this.init();
            }

            init() {
                this.updateDisplay();
                this.loadGameHistory();
                this.updateUserInfo();
            }

            updateUserInfo() {
                if (auth.isAuthenticated()) {
                    const user = auth.getUser();
                    console.log('ç•¶å‰ç”¨æˆ¶:', user);
                    document.getElementById('username').textContent = user.username;
                    
                    // å¦‚æœæ˜¯ç®¡ç†å“¡ï¼Œé¡¯ç¤ºå¾Œå°ç®¡ç†æŒ‰éˆ•
                    const adminBtn = document.getElementById('adminBtn');
                    if (user.role === 'admin') {
                        console.log('é¡¯ç¤ºç®¡ç†å“¡æŒ‰éˆ•');
                        adminBtn.classList.remove('hidden');
                    } else {
                        console.log('éš±è—ç®¡ç†å“¡æŒ‰éˆ•');
                        adminBtn.classList.add('hidden');
                    }
                }
            }

            // è¨˜éŒ„éŠæˆ²çµæœ
            recordResult(result) {
                // æª¢æŸ¥é–’å®¶å’ŒèŠå®¶çš„å‰å…©å¼µç‰Œæ˜¯å¦éƒ½å·²è¨˜éŒ„
                const playerCard1 = this.currentRound.player.cards[0];
                const playerCard2 = this.currentRound.player.cards[1];
                const bankerCard1 = this.currentRound.banker.cards[0];
                const bankerCard2 = this.currentRound.banker.cards[1];

                if (!playerCard1 || !playerCard2 || !bankerCard1 || !bankerCard2) {
                    alert('è«‹è¨˜éŒ„é–’å®¶å’ŒèŠå®¶çš„å‰å…©å¼µç‰Œè‰²ï¼\n(ç¬¬ä¸‰å¼µè£œç‰Œå¯é¸)');
                    return;
                }

                console.log('è¨˜éŒ„çµæœ:', result);
                console.log('ç•¶å‰ç‰Œé¢:', this.currentRound);

                // è¨˜éŒ„é€™ä¸€å±€
                const round = {
                    timestamp: new Date(),
                    player: [...this.currentRound.player.cards],
                    banker: [...this.currentRound.banker.cards],
                    result: result
                };

                this.gameHistory.push(round);
                this.saveGameHistory();
                this.updateDisplay();
                this.resetCurrentRound();
                this.generatePrediction();
            }

            // é‡ç½®ç•¶å‰å›åˆ
            resetCurrentRound() {
                this.currentRound = {
                    player: { cards: [null, null, null] },
                    banker: { cards: [null, null, null] }
                };

                // é‡ç½®ç‰Œçš„é¡¯ç¤º
                document.querySelectorAll('.card-slot').forEach(slot => {
                    slot.className = 'card-slot';
                });
            }

            // æ’¤éŠ·ä¸Šä¸€å±€
            undoLastRecord() {
                if (this.gameHistory.length > 0) {
                    this.gameHistory.pop();
                    this.saveGameHistory();
                    this.updateDisplay();
                    this.generatePrediction();
                }
            }

            // æ¸…ç©ºæ‰€æœ‰è¨˜éŒ„
            clearAllRecords() {
                if (confirm('ç¢ºå®šè¦æ¸…ç©ºæ‰€æœ‰éŠæˆ²è¨˜éŒ„å—ï¼Ÿ')) {
                    this.gameHistory = [];
                    this.saveGameHistory();
                    this.updateDisplay();
                    this.resetCurrentRound();
                    document.getElementById('predictionResult').innerHTML = `
                        <div class="prediction-text">è¨˜éŒ„è‡³å°‘5å±€å¾Œé¡¯ç¤ºé æ¸¬</div>
                        <div class="confidence">æº–ç¢ºåº¦å°‡æ ¹æ“šæ­·å²æ•¸æ“šè¨ˆç®—</div>
                    `;
                }
            }

            // æ›´æ–°é¡¯ç¤º
            updateDisplay() {
                this.updateRecordGrid();
                this.updateStatistics();
            }

            // æ›´æ–°è¨˜éŒ„ç¶²æ ¼
            updateRecordGrid() {
                const grid = document.getElementById('recordGrid');
                grid.innerHTML = '';

                // é¡¯ç¤ºå¯¦éš›çš„éŠæˆ²è¨˜éŒ„
                this.gameHistory.forEach((round, index) => {
                    const item = document.createElement('div');
                    item.className = `record-item ${round.result}`;
                    
                    let symbol = '';
                    switch (round.result) {
                        case 'banker': symbol = 'èŠ'; break;
                        case 'player': symbol = 'é–’'; break;
                        case 'tie': symbol = 'å’Œ'; break;
                    }
                    
                    item.textContent = symbol;
                    item.title = `ç¬¬${index + 1}å±€ï¼š${symbol}`;
                    grid.appendChild(item);
                });

                // æ ¹æ“šå±å¹•å¤§å°æ±ºå®šæ ¼å­ç¸½æ•¸
                const isMobile = window.innerWidth <= 768;
                const isSmallMobile = window.innerWidth <= 375;
                let totalCells;
                
                if (isSmallMobile) {
                    // å°å±æ‰‹æ©Ÿï¼š5è¡ŒÃ—8åˆ— = 40å€‹æ ¼å­
                    totalCells = Math.max(40, Math.ceil(this.gameHistory.length / 40) * 40);
                } else if (isMobile) {
                    // æ™®é€šæ‰‹æ©Ÿï¼š5è¡ŒÃ—10åˆ— = 50å€‹æ ¼å­
                    totalCells = Math.max(50, Math.ceil(this.gameHistory.length / 50) * 50);
                } else {
                    // æ¡Œé¢ç‰ˆï¼š5è¡ŒÃ—20åˆ— = 100å€‹æ ¼å­
                    totalCells = Math.max(100, Math.ceil(this.gameHistory.length / 100) * 100);
                }

                // æ·»åŠ ç©ºçš„ä½”ä½æ ¼å­ä¾†é¡¯ç¤ºç¶²æ ¼çµæ§‹
                for (let i = this.gameHistory.length; i < totalCells; i++) {
                    const item = document.createElement('div');
                    item.className = 'record-item empty';
                    grid.appendChild(item);
                }
            }

            // æ›´æ–°çµ±è¨ˆè³‡æ–™
            updateStatistics() {
                const total = this.gameHistory.length;
                const bankerWins = this.gameHistory.filter(r => r.result === 'banker').length;
                const playerWins = this.gameHistory.filter(r => r.result === 'player').length;
                const ties = this.gameHistory.filter(r => r.result === 'tie').length;

                document.getElementById('totalGames').textContent = total;
                document.getElementById('bankerWins').textContent = 
                    `${bankerWins} (${total > 0 ? Math.round(bankerWins/total*100) : 0}%)`;
                document.getElementById('playerWins').textContent = 
                    `${playerWins} (${total > 0 ? Math.round(playerWins/total*100) : 0}%)`;
                document.getElementById('tieGames').textContent = 
                    `${ties} (${total > 0 ? Math.round(ties/total*100) : 0}%)`;

                // æ›´æ–°è¶¨å‹¢åœ–è¡¨
                this.updateTrendChart();
            }



            // æ›´æ–°è¶¨å‹¢åœ–è¡¨
            updateTrendChart() {
                const canvas = document.getElementById('trendCanvas');
                if (!canvas) return;
                
                const ctx = canvas.getContext('2d');
                const width = canvas.width;
                const height = canvas.height;
                
                // æ¸…ç©ºç•«å¸ƒ
                ctx.clearRect(0, 0, width, height);
                
                if (this.gameHistory.length < 2) {
                    // é¡¯ç¤ºç­‰å¾…æ•¸æ“šçš„æç¤º
                    ctx.fillStyle = '#CCCCCC';
                    ctx.font = '16px Arial';
                    ctx.textAlign = 'center';
                    ctx.fillText('ğŸ“Š è¶¨å‹¢åœ–è¡¨', width/2, height/2 - 20);
                    ctx.font = '12px Arial';
                    ctx.fillStyle = '#999999';
                    ctx.fillText('è¨˜éŒ„æ›´å¤šå±€æ•¸ä»¥é¡¯ç¤ºè¶¨å‹¢', width/2, height/2 + 5);
                    return;
                }

                // å–æœ€è¿‘20å±€æ•¸æ“š
                const recentGames = this.gameHistory.slice(-20);
                const stepX = width / Math.max(recentGames.length - 1, 1);
                
                // è¨ˆç®—èŠå®¶å‹ç‡è¶¨å‹¢
                let bankerWins = 0;
                let totalGames = 0;
                const trendPoints = [];

                recentGames.forEach((game, index) => {
                    if (game.result === 'banker') bankerWins++;
                    if (game.result !== 'tie') totalGames++; // æ’é™¤å’Œå±€
                    
                    if (totalGames > 0) {
                        const bankerRate = bankerWins / totalGames;
                        const y = height - (bankerRate * height);
                        trendPoints.push({ 
                            x: index * stepX, 
                            y: y,
                            rate: bankerRate 
                        });
                    }
                });

                if (trendPoints.length > 0) {
                    // ç¹ªè£½èƒŒæ™¯ç¶²æ ¼
                    ctx.strokeStyle = 'rgba(255,255,255,0.1)';
                    ctx.lineWidth = 1;
                    
                    // æ°´å¹³ç¶²æ ¼ç·š (25%, 50%, 75%)
                    for (let i = 1; i <= 3; i++) {
                        const y = (height / 4) * i;
                        ctx.beginPath();
                        ctx.moveTo(0, y);
                        ctx.lineTo(width, y);
                        ctx.stroke();
                    }
                    
                    // 50%åŸºæº–ç·šåŠ ç²—
                    ctx.strokeStyle = 'rgba(255,255,255,0.3)';
                    ctx.lineWidth = 2;
                    ctx.beginPath();
                    ctx.moveTo(0, height/2);
                    ctx.lineTo(width, height/2);
                    ctx.stroke();

                    // ç¹ªè£½è¶¨å‹¢ç·š
                    if (trendPoints.length > 1) {
                        // æ¼¸è®Šè‰²è¶¨å‹¢ç·š
                        const gradient = ctx.createLinearGradient(0, 0, width, 0);
                        gradient.addColorStop(0, '#FF6B6B');
                        gradient.addColorStop(0.5, '#4ECDC4');
                        gradient.addColorStop(1, '#45B7D1');
                        
                        ctx.strokeStyle = gradient;
                        ctx.lineWidth = 3;
                        ctx.beginPath();
                        ctx.moveTo(trendPoints[0].x, trendPoints[0].y);
                        
                        for (let i = 1; i < trendPoints.length; i++) {
                            ctx.lineTo(trendPoints[i].x, trendPoints[i].y);
                        }
                        ctx.stroke();

                        // ç¹ªè£½æ•¸æ“šé»
                        trendPoints.forEach((point, index) => {
                            ctx.fillStyle = point.rate > 0.5 ? '#DC143C' : '#1E90FF';
                            ctx.beginPath();
                            ctx.arc(point.x, point.y, 4, 0, 2 * Math.PI);
                            ctx.fill();
                            
                            // é‚Šæ¡†
                            ctx.strokeStyle = '#FFFFFF';
                            ctx.lineWidth = 2;
                            ctx.stroke();
                        });
                    }

                    // æ·»åŠ æ¨™ç±¤å’Œæ•¸å€¼
                    ctx.fillStyle = '#CCCCCC';
                    ctx.font = 'bold 12px Arial';
                    ctx.textAlign = 'left';
                    ctx.fillText('èŠå®¶å‹ç‡è¶¨å‹¢', 10, 20);
                    
                    // é¡¯ç¤ºç•¶å‰å‹ç‡
                    const currentRate = trendPoints[trendPoints.length - 1].rate;
                    const percentage = Math.round(currentRate * 100);
                    ctx.textAlign = 'right';
                    ctx.fillStyle = currentRate > 0.5 ? '#DC143C' : '#1E90FF';
                    ctx.font = 'bold 14px Arial';
                    ctx.fillText(`${percentage}%`, width - 10, 20);
                    
                    // ç™¾åˆ†æ¯”æ¨™ç±¤
                    ctx.fillStyle = 'rgba(255,255,255,0.6)';
                    ctx.font = '10px Arial';
                    ctx.textAlign = 'right';
                    ctx.fillText('75%', width - 5, height * 0.25 + 3);
                    ctx.fillText('50%', width - 5, height * 0.5 + 3);
                    ctx.fillText('25%', width - 5, height * 0.75 + 3);
                }
            }

            // ç”Ÿæˆé æ¸¬å»ºè­°
            generatePrediction() {
                if (this.gameHistory.length < 5) {
                    return;
                }

                const recent = this.gameHistory.slice(-10);
                const analysis = this.analyzeTrends(recent);
                
                document.getElementById('predictionResult').innerHTML = `
                    <div class="prediction-text">å»ºè­°ä¸‹æ³¨ï¼š<strong>${analysis.suggestion}</strong></div>
                    <div class="confidence">ä¿¡å¿ƒåº¦ï¼š${analysis.confidence}% | åŸºæ–¼${recent.length}å±€åˆ†æ</div>
                `;
            }

            // åˆ†æè¶¨å‹¢
            analyzeTrends(history) {
                const last5 = history.slice(-5);
                const bankerCount = last5.filter(r => r.result === 'banker').length;
                const playerCount = last5.filter(r => r.result === 'player').length;
                const tieCount = last5.filter(r => r.result === 'tie').length;

                // ç°¡å–®çš„é æ¸¬é‚è¼¯
                let suggestion = '';
                let confidence = 0;

                if (bankerCount >= 3) {
                    suggestion = 'é–’å®¶';
                    confidence = 60 + (bankerCount - 3) * 10;
                } else if (playerCount >= 3) {
                    suggestion = 'èŠå®¶';
                    confidence = 60 + (playerCount - 3) * 10;
                } else if (tieCount >= 2) {
                    suggestion = bankerCount > playerCount ? 'èŠå®¶' : 'é–’å®¶';
                    confidence = 55;
                } else {
                    suggestion = bankerCount > playerCount ? 'é–’å®¶' : 'èŠå®¶';
                    confidence = 50;
                }

                return { suggestion, confidence: Math.min(confidence, 85) };
            }

            // ä¿å­˜éŠæˆ²æ­·å²
            saveGameHistory() {
                localStorage.setItem('baccaratGameHistory', JSON.stringify(this.gameHistory));
            }

            // è¼‰å…¥éŠæˆ²æ­·å²
            loadGameHistory() {
                const saved = localStorage.getItem('baccaratGameHistory');
                if (saved) {
                    this.gameHistory = JSON.parse(saved);
                    this.updateDisplay();
                    if (this.gameHistory.length >= 5) {
                        this.generatePrediction();
                    }
                }
            }
        }

        // å…¨åŸŸå‡½æ•¸
        let game;

        function cycleCardColor(element) {
            console.log('cycleCardColor å‡½æ•¸è¢«èª¿ç”¨');
            console.log('element:', element);
            
            // æª¢æŸ¥gameå°è±¡æ˜¯å¦å­˜åœ¨
            if (!window.game) {
                console.error('game å°è±¡æœªåˆå§‹åŒ–');
                return;
            }
            
            const type = element.getAttribute('data-type');
            const index = parseInt(element.getAttribute('data-index'));
            
            console.log(`é¡å‹: ${type}, ç´¢å¼•: ${index}`);
            
            // ç²å–ç•¶å‰é¡è‰²ç‹€æ…‹
            let currentColor = null;
            if (element.classList.contains('red')) {
                currentColor = 'red';
            } else if (element.classList.contains('black')) {
                currentColor = 'black';
            }
            
            // æŒ‰ç…§ é€æ˜->ç´…->é»‘->ç´…->é»‘... çš„é †åºåˆ‡æ›
            let nextColor;
            if (currentColor === null) {
                nextColor = 'red';
            } else if (currentColor === 'red') {
                nextColor = 'black';
            } else if (currentColor === 'black') {
                nextColor = 'red';
            }
            
            console.log(`ç•¶å‰é¡è‰²: ${currentColor}, ä¸‹ä¸€å€‹é¡è‰²: ${nextColor}`);
            
            // æ›´æ–°éŠæˆ²ç‹€æ…‹
            game.currentRound[type].cards[index] = nextColor;
            
            // æ›´æ–°è¦–è¦ºæ•ˆæœ
            element.className = `card-slot ${nextColor}`;
            
            console.log(`${type} ç‰Œä½ ${index} åˆ‡æ›åˆ°: ${nextColor}`);
        }

        function recordResult(result) {
            game.recordResult(result);
        }

        function undoLastRecord() {
            game.undoLastRecord();
        }

        function clearAllRecords() {
            game.clearAllRecords();
        }

        function goToAdmin() {
            console.log('goToAdmin å‡½æ•¸è¢«èª¿ç”¨');
            // è·³è½‰åˆ°ç®¡ç†å“¡å¾Œå°
            window.location.href = '/admin';
        }

        // é é¢è¼‰å…¥å®Œæˆå¾Œåˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            // å»¶é²æª¢æŸ¥ç™»å…¥ç‹€æ…‹ï¼Œé¿å…èˆ‡ç™»å…¥é é¢çš„é‡å®šå‘è¡çª
            setTimeout(() => {
                if (!auth.isAuthenticated()) {
                    console.log('æœªèªè­‰ï¼Œé‡å®šå‘åˆ°ç™»å…¥é é¢');
                    window.location.href = '/login';
                    return;
                }

                // åˆå§‹åŒ–éŠæˆ²
                game = new BaccaratGame();
                window.game = game; // ç¢ºä¿å…¨åŸŸå¯ç”¨
            }, 100);
            
            console.log('éŠæˆ²åˆå§‹åŒ–å®Œæˆ');
            console.log('gameå°è±¡:', game);

            // ç¶å®šç‰Œä½é»æ“Šäº‹ä»¶
            const cardSlots = document.querySelectorAll('.card-slot');
            console.log(`æ‰¾åˆ° ${cardSlots.length} å€‹ç‰Œä½å…ƒç´ `);
            
            cardSlots.forEach((slot, index) => {
                console.log(`ç¶å®šç¬¬ ${index + 1} å€‹ç‰Œä½:`, slot);
                console.log(`data-type: ${slot.getAttribute('data-type')}, data-index: ${slot.getAttribute('data-index')}`);
                
                slot.addEventListener('click', function() {
                    console.log(`=== ç‰Œä½ ${index + 1} è¢«é»æ“Š ===`);
                    console.log('this:', this);
                    testCardClick(this);
                });
                
                // æ·»åŠ è§¸æ‘¸äº‹ä»¶æ”¯æŒï¼ˆç”¨æ–¼æ‰‹æ©Ÿï¼‰
                slot.addEventListener('touchstart', function(e) {
                    e.preventDefault();
                    console.log(`=== ç‰Œä½ ${index + 1} è¢«è§¸æ‘¸ ===`);
                    testCardClick(this);
                });
            });
            
            // ç¶å®šæŒ‰éˆ•äº‹ä»¶
            const logoutBtn = document.getElementById('logoutBtn');
            const adminBtn = document.getElementById('adminBtn');
            
            if (logoutBtn) {
                logoutBtn.addEventListener('click', function(e) {
                    e.preventDefault();
                    console.log('ç™»å‡ºæŒ‰éˆ•è¢«é»æ“Š');
                    logout();
                });
            }
            
            if (adminBtn) {
                adminBtn.addEventListener('click', function(e) {
                    e.preventDefault();
                    console.log('å¾Œå°ç®¡ç†æŒ‰éˆ•è¢«é»æ“Š');
                    goToAdmin();
                });
            }
            
            // ç¶å®šéŠæˆ²è¨˜éŒ„æŒ‰éˆ•äº‹ä»¶
            const clearBtn = document.getElementById('clearBtn');
            const undoBtn = document.getElementById('undoBtn');
            const bankerBtn = document.getElementById('bankerBtn');
            const tieBtn = document.getElementById('tieBtn');
            const playerBtn = document.getElementById('playerBtn');
            
            if (clearBtn) {
                clearBtn.addEventListener('click', function() {
                    console.log('æ¸…ç©ºè¨˜éŒ„æŒ‰éˆ•è¢«é»æ“Š');
                    if (game) game.clearAllRecords();
                });
            }
            
            if (undoBtn) {
                undoBtn.addEventListener('click', function() {
                    console.log('æ’¤éŠ·æŒ‰éˆ•è¢«é»æ“Š');
                    if (game) game.undoLastRecord();
                });
            }
            
            if (bankerBtn) {
                bankerBtn.addEventListener('click', function() {
                    console.log('èŠå®¶æŒ‰éˆ•è¢«é»æ“Š');
                    if (game) game.recordResult('banker');
                });
            }
            
            if (tieBtn) {
                tieBtn.addEventListener('click', function() {
                    console.log('å’Œå±€æŒ‰éˆ•è¢«é»æ“Š');
                    if (game) game.recordResult('tie');
                });
            }
            
            if (playerBtn) {
                playerBtn.addEventListener('click', function() {
                    console.log('é–’å®¶æŒ‰éˆ•è¢«é»æ“Š');
                    if (game) game.recordResult('player');
                });
            }

            // åˆå§‹åŒ–è¶¨å‹¢åœ–è¡¨
            setupTrendChart();
            
            // ç›£è½çª—å£å¤§å°è®ŠåŒ–ï¼Œé‡æ–°èª¿æ•´ç¶²æ ¼
            window.addEventListener('resize', function() {
                if (game) {
                    game.updateRecordGrid();
                }
            });
        });

        // è¨­ç½®è¶¨å‹¢åœ–è¡¨
        function setupTrendChart() {
            const canvas = document.getElementById('trendCanvas');
            if (canvas) {
                resizeCanvas();
                window.addEventListener('resize', resizeCanvas);
                
                // æ·»åŠ é»æ“Šåˆ·æ–°åŠŸèƒ½
                canvas.addEventListener('click', function() {
                    if (game) {
                        game.updateTrendChart();
                    }
                });
            }
        }

        // èª¿æ•´Canvaså¤§å°
        function resizeCanvas() {
            const canvas = document.getElementById('trendCanvas');
            if (!canvas) return;
            
            const container = canvas.parentElement;
            canvas.width = container.clientWidth - 20;
            canvas.height = 180;
            
            // é‡æ–°ç¹ªè£½åœ–è¡¨
            if (game) {
                game.updateTrendChart();
            }
        }
    </script>
</body>
</html>
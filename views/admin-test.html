<!DOCTYPE html>
<html>
<head>
    <title>ç®¡ç†å“¡ç™»éŒ„æ¸¬è©¦</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 50px; }
        .form-group { margin: 10px 0; }
        input { padding: 8px; width: 200px; }
        button { padding: 10px 20px; background: #007bff; color: white; border: none; }
        .result { margin: 20px 0; padding: 10px; border: 1px solid #ddd; }
        .success { background: #d4edda; }
        .error { background: #f8d7da; }
    </style>
</head>
<body>
    <h1>ğŸ” ç®¡ç†å“¡ç™»éŒ„æ¸¬è©¦</h1>
    
    <div class="form-group">
        <label>å¸³è™Ÿ:</label><br>
        <input type="text" id="username" value="admin" placeholder="ç®¡ç†å“¡å¸³è™Ÿ">
    </div>
    
    <div class="form-group">
        <label>å¯†ç¢¼:</label><br>
        <input type="password" id="password" value="admin123" placeholder="ç®¡ç†å“¡å¯†ç¢¼">
    </div>
    
    <button onclick="testLogin()">ğŸš€ æ¸¬è©¦ç™»éŒ„</button>
    <button onclick="testAdminAPI()">ğŸ“Š æ¸¬è©¦ç®¡ç†å“¡ API</button>
    
    <div id="result" class="result" style="display:none;"></div>
    
    <script>
        let authToken = localStorage.getItem('token');
        
        if (authToken) {
            document.getElementById('result').style.display = 'block';
            document.getElementById('result').className = 'result success';
            document.getElementById('result').innerHTML = 'âœ… å·²æœ‰ç™»éŒ„ä»¤ç‰Œ: ' + authToken.substring(0, 20) + '...';
        }
        
        async function testLogin() {
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            const resultDiv = document.getElementById('result');
            
            try {
                const response = await fetch('/api/auth/login', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ username, password })
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    authToken = data.token;
                    localStorage.setItem('token', authToken);
                    
                    resultDiv.style.display = 'block';
                    resultDiv.className = 'result success';
                    resultDiv.innerHTML = 'âœ… ç™»éŒ„æˆåŠŸï¼<br>ä»¤ç‰Œ: ' + authToken.substring(0, 50) + '...<br>ç”¨æˆ¶: ' + JSON.stringify(data.user);
                } else {
                    throw new Error(data.error || 'ç™»éŒ„å¤±æ•—');
                }
            } catch (error) {
                resultDiv.style.display = 'block';
                resultDiv.className = 'result error';
                resultDiv.innerHTML = 'âŒ ç™»éŒ„å¤±æ•—: ' + error.message;
            }
        }
        
        async function testAdminAPI() {
            const resultDiv = document.getElementById('result');
            
            if (!authToken) {
                resultDiv.style.display = 'block';
                resultDiv.className = 'result error';
                resultDiv.innerHTML = 'âŒ è«‹å…ˆç™»éŒ„ç²å–ä»¤ç‰Œ';
                return;
            }
            
            try {
                // æ¸¬è©¦ç”¨æˆ¶ API
                const usersResponse = await fetch('/api/admin/users', {
                    headers: {
                        'Authorization': 'Bearer ' + authToken
                    }
                });
                
                const usersData = await usersResponse.json();
                
                // æ¸¬è©¦çµ±è¨ˆ API
                const statsResponse = await fetch('/api/admin/stats', {
                    headers: {
                        'Authorization': 'Bearer ' + authToken
                    }
                });
                
                const statsData = await statsResponse.json();
                
                resultDiv.style.display = 'block';
                resultDiv.className = 'result success';
                resultDiv.innerHTML = 'âœ… ç®¡ç†å“¡ API æ¸¬è©¦æˆåŠŸï¼<br><br>' +
                    '<strong>ç”¨æˆ¶æ•¸æ“š:</strong><br>' + JSON.stringify(usersData, null, 2) + '<br><br>' +
                    '<strong>çµ±è¨ˆæ•¸æ“š:</strong><br>' + JSON.stringify(statsData, null, 2);
                    
            } catch (error) {
                resultDiv.style.display = 'block';
                resultDiv.className = 'result error';
                resultDiv.innerHTML = 'âŒ ç®¡ç†å“¡ API æ¸¬è©¦å¤±æ•—: ' + error.message;
            }
        }
    </script>
</body>
</html>